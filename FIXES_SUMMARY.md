# –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–±–ª–µ–º

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è anna@beauty.com
**–ü—Ä–∏—á–∏–Ω–∞:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `anna_clients` –Ω–µ –∏–º–µ–ª–∏ `WITH CHECK` clause
- –ü—Ä–∏ INSERT –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Ç–æ–ª—å–∫–æ USING, –Ω–æ –∏ WITH CHECK

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `WITH CHECK` clause
- –°–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤: `supabase/diagnose_and_fix.sql`

---

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 2: –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ /admin –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
**–ü—Ä–∏—á–∏–Ω–∞:**
- –§–∞–π–ª `src/components/ProtectedRoute.tsx` –±—ã–ª —É–¥–∞–ª–µ–Ω, –Ω–æ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ `App.tsx`
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–µ –∏–º–ø–æ—Ä—Ç–∞ –∏ –∑–∞–≤–∏—Å–∞–Ω–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª `src/components/ProtectedRoute.tsx` –∏–∑ git –∏—Å—Ç–æ—Ä–∏–∏
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã:
  - ProtectedRoute: –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö ‚Üí `/admin/login`
  - PublicRoute: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö ‚Üí `/admin`

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 3: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç /preis –∏ —Å–æ–±—ã—Ç–∏—è
**–ü—Ä–∏—á–∏–Ω–∞:**
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–∑ —Å—Ç–∞—Ä—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- –°—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `TO public` –≤–º–µ—Å—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è `TO anon` / `TO authenticated`
- –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (is_published = false)

**–†–µ—à–µ–Ω–∏–µ:**
- –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏
- –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–π:
  - `anon`: –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ `is_published = true`
  - `authenticated`: –≤–∏–¥—è—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ

---

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (–õ–û–ö–ê–õ–¨–ù–û)

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Supabase –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
supabase start

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
psql \
  postgresql://postgres:postgres@localhost:54322/postgres \
  -f supabase/diagnose_and_fix.sql
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–æ–ª–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
3. ‚úÖ –£–¥–∞–ª–∏—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏
4. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
5. ‚úÖ –û–ø—É–±–ª–∏–∫—É–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
6. ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –®–∞–≥ 2: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ

1. **–¢–µ—Å—Ç #1 - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:**
   ```
   - –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ anna@beauty.com
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ —Å–ø–∏—Å–∫–µ
   ```

2. **–¢–µ—Å—Ç #2 - –°—Ç—Ä–∞–Ω–∏—Ü–∞ /admin:**
   ```
   - –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã: –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ /admin
   - –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏—è
   - –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /admin/login
   ```

3. **–¢–µ—Å—Ç #3 - –í–∏–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞:**
   ```
   - –í—ã–π–¥–∏—Ç–µ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ (–∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –æ–∫–Ω–æ)
   - –û—Ç–∫—Ä–æ–π—Ç–µ /preis
   - –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —Ü–µ–Ω—ã, –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
   - –°–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ /preis
   - –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç (–≤–∫–ª—é—á–∞—è –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–π)
   ```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ PRODUCTION

**‚ö†Ô∏è –í–ê–ñ–ù–û: –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ!**

```bash
# 1. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "fix: Restore ProtectedRoute and fix RLS policies for clients and public data"

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ production
supabase db push

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ diagnose_and_fix.sql –Ω–∞ production
# (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor)

# 4. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –∫–æ–¥
git push
```

---

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] ‚úÖ ProtectedRoute.tsx –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] ‚úÖ diagnose_and_fix.sql —Å–æ–∑–¥–∞–Ω
- [ ] üî≤ –õ–æ–∫–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω diagnose_and_fix.sql
- [ ] üî≤ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è anna@beauty.com
- [ ] üî≤ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –¥–æ—Å—Ç—É–ø –∫ /admin –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
- [ ] üî≤ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤–∏–¥–∏–º–æ—Å—Ç—å /preis –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
- [ ] üî≤ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤–∏–¥–∏–º–æ—Å—Ç—å /preis –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
- [ ] üî≤ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] üî≤ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ production
- [ ] üî≤ diagnose_and_fix.sql –≤—ã–ø–æ–ª–Ω–µ–Ω –Ω–∞ production
- [ ] üî≤ –ö–æ–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data: { user } } = await supabase.auth.getUser()
console.log('User:', user)
console.log('Role:', user?.user_metadata?.role)
console.log('Auth UID:', user?.id)
```

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ - —Ç–∞–º –±—É–¥—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö RLS.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ö–∞–∂–¥—ã–π –º–∞—Å—Ç–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `raw_user_meta_data->>'role'`
- Admin –≤–∏–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü—ã:** prices, subscriptions, events, price_categories
- **Anonymous (anon):** `SELECT WHERE is_published = true`
- **Authenticated:** `SELECT/INSERT/UPDATE/DELETE` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–ª–µ–π
- `admin` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
- `anna`, `lera`, `liudmila`, `natalia`, `yulia` - –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º
- –†–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `user_metadata.role` –∏–ª–∏ `raw_user_meta_data.role`
